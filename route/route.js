"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),getRouter=require("router"),router=getRouter(),Student=require("../model/user"),queryString=require("querystring"),url=require("url"),template=require("art-template");router.get("/",function(e,r){r.writeHead(301,{Location:"/list"}),r.end()}),router.get("/index",function(e,r){r.writeHead(301,{Location:"/list"}),r.end()}),router.get("/add",function(e,r){var t=template("add.art",{});r.end(t)}),router.get("/updata",function(){var t=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(r,t){var n,a,u,o,i,c,d;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=url.parse(r.url,!0),a=n.query,u=a.id.replace(/(\")/g,""),e.next=4,Student.findOne({_id:u});case 4:o=e.sent,i=o.direction,c=[],["前端","后端","全栈","架构师","大数据","UI设计","产品经理","AI算法"].forEach(function(e){i.includes(e)||c.push(e)}),d=template("updata.art",{result:o,notchoose:c}),t.end(d);case 11:case"end":return e.stop()}},e)}));return function(e,r){return t.apply(this,arguments)}}()),router.get("/list",function(){var t=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(r,t){var n,a;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Student.find();case 2:n=e.sent,a=template("list.art",{students:n}),t.end(a);case 5:case"end":return e.stop()}},e)}));return function(e,r){return t.apply(this,arguments)}}()),router.get("/delete",function(){var t=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(r,t){var n,a,u;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=url.parse(r.url,!0),a=n.query,u=a.id.replace(/(\")/g,""),e.next=4,Student.findOneAndDelete({_id:u});case 4:t.writeHead(301,{Location:"/list"}),t.end();case 6:case"end":return e.stop()}},e)}));return function(e,r){return t.apply(this,arguments)}}()),router.post("/add",function(e,r){var t="";e.on("data",function(e){t+=e}),e.on("end",(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(){return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Student.create(queryString.parse(t));case 2:r.writeHead(301,{Location:"/list"}),r.end();case 4:case"end":return e.stop()}},e)})))}),router.post("/updata",function(e,t){var n=url.parse(e.url,!0).query.id.replace(/(\")/g,""),a="";e.on("data",function(e){a+=e}),e.on("end",(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(){var r;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=queryString.parse(a),e.next=3,Student.updateMany({_id:n},r);case 3:t.writeHead(301,{Location:"/list"}),t.end();case 5:case"end":return e.stop()}},e)})))}),module.exports=router;